
########################################################################################################################################################
########################################################################################################################################################
########################################################################################################################################################
########################################################################################################################################################
oilchange <- read.csv("http://astro.temple.edu/~zhaozhg/Stat8003/data/speedyoilchange.csv", header=FALSE)
plot( density( oilchange$V1 ) )
oilchange.xbar <- mean( oilchange$V1 )
oilchange.sSq <- var( oilchange$V1 )
oilchange.Tstat <- ( oilchange.xbar - 30 )/( sqrt( oilchange.sSq)/sqrt( length(oilchange$V1) ) ) 
oilchange.pvalue <- pt( oilchange.Tstat, length(oilchange$V1) -1 )

t.test(oilchange,mu=30)


########################################################################################################################################################
########################################################################################################################################################
########################################################################################################################################################
########################################################################################################################################################


########################################################################################################################################################
########################################################################################################################################################
########################################################################################################################################################
########################################################################################################################################################
#### Example 4.3.4
X <- read.table("http://astro.temple.edu/~zhaozhg/Stat8003/data/prostate_X.csv",sep=",")
Y <- read.table("http://astro.temple.edu/~zhaozhg/Stat8003/data/prostate_Y.csv",sep=",")

equalvar <- function(Xi, group)
  {
    n1 <- length( which(group==1) )
    n2 <- length( which(group==2) )
    mean1 <- mean(Xi[ group==1] )
    mean2 <- mean(Xi[ group==2] )
    s1 <- var( Xi[group==1] )
    s2 <- var( Xi[group==2] )

    s.pool <- ( (n1-1)*s1 + (n2-1)*s2 )/( n1+n2-2 )
    t.stat <- (mean1-mean2)/(sqrt(s.pool)*sqrt(1/n1+1/n2) )

    pvalue <- 2*pt( -abs(t.stat), n1+n2-2 )
    
  }

unequalvar <- function(Xi, group)
  {
    n1 <- length( which(group==1) )
    n2 <- length( which(group==2) )
    mean1 <- mean(Xi[ group==1] )
    mean2 <- mean(Xi[ group==2] )
    s1 <- var( Xi[group==1] )
    s2 <- var( Xi[group==2] )

    s.unpool <- (s1/n1 +s2/n2 )
    t.stat <- (mean1-mean2)/sqrt(s.unpool)
    df.sat <- (s1/n1+s2/n2)^2/( (s1/n1)^2/(n1-1) + (s2/n2)^2/(n2-1) )
    pvalue <- 2*pt( -abs( t.stat), df.sat )
    
  }
testvariance <- function(Xi, group )
  {
    n1 <- length( which(group==1) )
    n2 <- length( which(group==2) )
    s1 <- var( Xi[group==1] )
    s2 <- var( Xi[group==2] )
    
    F.stat <- s1/s2
    pvalue <- 2*(F.stat <= 1)*pf( F.stat, n1-1, n2-1 ) +  2*(F.stat>1) * (1-pf( F.stat,n1-1,n2-1) )     
  }

pvalue.equalvar <- apply( X, 1, equalvar, Y)
pvalue.unequalvar <- apply( X, 1, unequalvar, Y)
pvalue.ftest <- apply( X, 1, testvariance, Y)

t.test( X[1, which(Y==1)], X[1, which(Y==2)], var.equal=TRUE, conf.level=0.99)

